<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Farming Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #283048 0%, #859398 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        header h1 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        nav button {
            background: linear-gradient(135deg, #4a7c59 0%, #2d5a3d 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        nav button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 124, 89, 0.4);
        }

        nav button.active {
            background: linear-gradient(135deg, #6ba573 0%, #4a7c59 100%);
            box-shadow: 0 0 10px rgba(107, 165, 115, 0.5);
        }

        .stats-panel {
            background: rgba(0, 0, 0, 0.25);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-item .label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-item .value {
            font-size: 18px;
            font-weight: bold;
            color: #6ba573;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #4a7c59 0%, #2d5a3d 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 124, 89, 0.4);
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-danger {
            background: linear-gradient(135deg, #c0392b 0%, #962d22 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #5a6c7d 0%, #3d4a56 100%);
        }

        .btn-gold {
            background: linear-gradient(135deg, #d4a017 0%, #a67c00 100%);
        }

        .farm-btn {
            font-size: 20px;
            padding: 20px 40px;
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 20px auto;
        }

        .cooldown-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: #6ba573;
            transition: width 0.1s linear;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        select {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            min-width: 200px;
        }

        select option {
            background: #283048;
            color: white;
        }

        .selectors {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .selector-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .selector-group label {
            font-size: 12px;
            opacity: 0.8;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            animation: slideIn 0.3s ease, fadeOut 0.5s ease 2s forwards;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.normal { background: linear-gradient(135deg, #27ae60, #1e8449); }
        .notification.rare { background: linear-gradient(135deg, #3498db, #2980b9); }
        .notification.epic { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .notification.mythical { background: linear-gradient(135deg, #e91e63, #c2185b); }
        .notification.legendary { background: linear-gradient(135deg, #f39c12, #d68910); }
        .notification.achievement { background: linear-gradient(135deg, #f1c40f, #d4ac0d); }
        .notification.error { background: linear-gradient(135deg, #e74c3c, #c0392b); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(-20px); }
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .item-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .item-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }

        .item-card h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .item-card .details {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .item-card .price {
            color: #f1c40f;
            font-weight: bold;
        }

        .item-card .owned {
            color: #6ba573;
        }

        .item-card .level {
            color: #3498db;
        }

        .item-card .equipped {
            color: #e74c3c;
            font-weight: bold;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .pagination span {
            font-size: 14px;
            opacity: 0.8;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .inventory-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .inventory-item .name {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .inventory-item .count {
            font-size: 18px;
            font-weight: bold;
            color: #6ba573;
        }

        .inventory-item.normal { border-left: 3px solid #27ae60; }
        .inventory-item.rare { border-left: 3px solid #3498db; }
        .inventory-item.epic { border-left: 3px solid #9b59b6; }
        .inventory-item.mythical { border-left: 3px solid #e91e63; }
        .inventory-item.legendary { border-left: 3px solid #f39c12; }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .achievement-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .achievement-card.unlocked {
            background: rgba(241, 196, 15, 0.15);
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .achievement-icon {
            font-size: 30px;
            width: 50px;
            text-align: center;
        }

        .achievement-info h4 {
            margin-bottom: 5px;
        }

        .achievement-info p {
            font-size: 13px;
            opacity: 0.7;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .prestige-info {
            text-align: center;
            padding: 30px;
        }

        .prestige-info h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .prestige-bonus {
            font-size: 1.2em;
            color: #f1c40f;
            margin: 15px 0;
        }

        .save-area {
            margin-top: 15px;
        }

        .save-area textarea {
            width: 100%;
            height: 100px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }

        .keyboard-hint {
            font-size: 11px;
            opacity: 0.6;
            text-align: center;
            margin-top: 10px;
        }

        .fertilizer-display {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .fertilizer-badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }

        @media (max-width: 600px) {
            .container { padding: 10px; }
            header h1 { font-size: 1.4em; }
            nav button { padding: 8px 12px; font-size: 12px; }
            .stats-panel { grid-template-columns: repeat(2, 1fr); }
            .farm-btn { padding: 15px 30px; font-size: 16px; }
            .items-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåæ Virtual Farming Simulator</h1>
            <nav>
                <button class="active" onclick="showPage('main')">üè† Farm</button>
                <button onclick="showPage('inventory')">üì¶ Inventory</button>
                <button onclick="showPage('shop-hoe')">‚õèÔ∏è Hoes</button>
                <button onclick="showPage('shop-fertilizer')">üß™ Fertilizers</button>
                <button onclick="showPage('upgrades')">‚¨ÜÔ∏è Upgrades</button>
                <button onclick="showPage('achievements')">üèÜ Achievements</button>
                <button onclick="showPage('stats')">üìä Statistics</button>
                <button onclick="showPage('prestige')">‚≠ê Prestige</button>
                <button onclick="showPage('settings')">‚öôÔ∏è Settings</button>
            </nav>
        </header>

        <div class="stats-panel" id="statsPanel"></div>

        <div id="notificationContainer"></div>

        <!-- Main Farm Page -->
        <div id="main" class="page active">
            <div class="card">
                <h2>üå± Farm Your Crops</h2>
                <div class="selectors">
                    <div class="selector-group">
                        <label>Select Hoe:</label>
                        <select id="hoeSelect" onchange="selectHoe(this.value)"></select>
                    </div>
                    <div class="selector-group">
                        <label>Select Fertilizer:</label>
                        <select id="fertilizerSelect" onchange="selectFertilizer(this.value)"></select>
                    </div>
                </div>
                <button class="btn farm-btn" id="farmBtn" onclick="farm()">
                    üåæ FARM
                    <div class="cooldown-bar" id="cooldownBar"></div>
                </button>
                <div class="action-buttons">
                    <button class="btn btn-gold" onclick="sellAll()">üí∞ Sell All Plants</button>
                </div>
                <p class="keyboard-hint">Keyboard: [Space] Farm | [S] Sell | [1-9] Select Hoe | [F] Cycle Fertilizer</p>
            </div>
            <div class="card">
                <h2>üß™ Your Fertilizers</h2>
                <div class="fertilizer-display" id="fertilizerDisplay"></div>
            </div>
        </div>

        <!-- Inventory Page -->
        <div id="inventory" class="page">
            <div class="card">
                <h2>üì¶ Inventory</h2>
                <div class="filters">
                    <label>Filter: </label>
                    <select id="inventoryFilter" onchange="renderInventory()">
                        <option value="all">All Plants</option>
                        <option value="normal">Normal</option>
                        <option value="rare">Rare</option>
                        <option value="epic">Epic</option>
                        <option value="mythical">Mythical</option>
                        <option value="legendary">Legendary</option>
                    </select>
                    <label>Sort: </label>
                    <select id="inventorySort" onchange="renderInventory()">
                        <option value="name">Name</option>
                        <option value="quantity">Quantity</option>
                        <option value="value">Value</option>
                        <option value="rarity">Rarity</option>
                    </select>
                </div>
                <div class="inventory-grid" id="inventoryGrid"></div>
                <div class="action-buttons" style="margin-top: 20px;">
                    <button class="btn btn-gold" onclick="sellAll()">üí∞ Sell All Plants</button>
                </div>
            </div>
        </div>

        <!-- Hoe Shop Page -->
        <div id="shop-hoe" class="page">
            <div class="card">
                <h2>‚õèÔ∏è Hoe Shop</h2>
                <div class="items-grid" id="hoeShopGrid"></div>
            </div>
        </div>

        <!-- Fertilizer Shop Page -->
        <div id="shop-fertilizer" class="page">
            <div class="card">
                <h2>üß™ Fertilizer Shop</h2>
                <div class="items-grid" id="fertilizerShopGrid"></div>
            </div>
        </div>

        <!-- Upgrades Page -->
        <div id="upgrades" class="page">
            <div class="card">
                <h2>‚¨ÜÔ∏è Upgrades</h2>
                <div class="items-grid" id="upgradesGrid"></div>
                <div class="pagination">
                    <button class="btn btn-secondary" onclick="changeUpgradePage(-1)">‚Üê Previous</button>
                    <span id="upgradePageInfo">Page 1</span>
                    <button class="btn btn-secondary" onclick="changeUpgradePage(1)">Next ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Achievements Page -->
        <div id="achievements" class="page">
            <div class="card">
                <h2>üèÜ Achievements</h2>
                <div class="items-grid" id="achievementsGrid"></div>
            </div>
        </div>

        <!-- Statistics Page -->
        <div id="stats" class="page">
            <div class="card">
                <h2>üìä Detailed Statistics</h2>
                <div class="stats-grid" id="detailedStats"></div>
            </div>
        </div>

        <!-- Prestige Page -->
        <div id="prestige" class="page">
            <div class="card">
                <div class="prestige-info">
                    <h3>‚≠ê Prestige System</h3>
                    <p>Reset your progress for permanent bonuses!</p>
                    <div class="prestige-bonus" id="prestigeBonus"></div>
                    <div id="prestigeRequirement"></div>
                    <button class="btn btn-gold" id="prestigeBtn" onclick="prestige()" style="margin-top: 20px;">
                        ‚≠ê Prestige Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="card">
                <h2>‚öôÔ∏è Settings</h2>
                <div class="action-buttons">
                    <button class="btn" onclick="exportSave()">üì§ Export Save</button>
                    <button class="btn" onclick="importSave()">üì• Import Save</button>
                    <button class="btn btn-danger" onclick="resetGame()">üóëÔ∏è Reset Game</button>
                </div>
                <div class="save-area">
                    <label>Save Data:</label>
                    <textarea id="saveTextarea" placeholder="Export or paste save data here..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===================== DATA DEFINITIONS =====================
        const HOES = [
            { name: "Wooden Hoe", multiplier: 1.0, cost: 0, emoji: "ü™µ" },
            { name: "Stone Hoe", multiplier: 1.1, cost: 500, emoji: "ü™®" },
            { name: "Lapis Hoe", multiplier: 1.2, cost: 1000, emoji: "üíé" },
            { name: "Gold Hoe", multiplier: 1.3, cost: 1500, emoji: "ü•á" },
            { name: "Iron Hoe", multiplier: 1.4, cost: 2000, emoji: "‚öôÔ∏è" },
            { name: "Diamond Hoe", multiplier: 1.5, cost: 2500, emoji: "üí†" },
            { name: "Netherite Hoe", multiplier: 1.7, cost: 3000, emoji: "üî•" },
            { name: "Special Hoe", multiplier: 2.0, cost: 5000, emoji: "‚ú®" },
            { name: "Emerald Hoe", multiplier: 2.2, cost: 7000, emoji: "üíö" },
            { name: "Obsidian Hoe", multiplier: 2.5, cost: 10000, emoji: "üñ§" },
            { name: "Mythic Hoe", multiplier: 3.0, cost: 15000, emoji: "üîÆ" },
            { name: "Platinum Hoe", multiplier: 3.2, cost: 20000, emoji: "ü™ô" },
            { name: "Titanium Hoe", multiplier: 3.5, cost: 25000, emoji: "‚ö°" }
        ];

        const PLANTS = [
            { name: "Lettuce", price: 6, rarity: "normal", minHoe: 0, emoji: "ü•¨" },
            { name: "Potato", price: 7, rarity: "normal", minHoe: 0, emoji: "ü•î" },
            { name: "Spinach", price: 7, rarity: "normal", minHoe: 0, emoji: "ü•ó" },
            { name: "Tomato", price: 8, rarity: "normal", minHoe: 0, emoji: "üçÖ" },
            { name: "Cucumber", price: 9, rarity: "normal", minHoe: 0, emoji: "ü•í" },
            { name: "Carrot", price: 10, rarity: "normal", minHoe: 0, emoji: "ü•ï" },
            { name: "Crimson Carrot", price: 10, rarity: "normal", minHoe: 0, emoji: "ü•ï" },
            { name: "Golden Wheat", price: 12, rarity: "normal", minHoe: 0, emoji: "üåæ" },
            { name: "Bell Pepper", price: 11, rarity: "rare", minHoe: 1, emoji: "ü´ë" },
            { name: "Eggplant", price: 12, rarity: "rare", minHoe: 1, emoji: "üçÜ" },
            { name: "Broccoli", price: 13, rarity: "rare", minHoe: 2, emoji: "ü•¶" },
            { name: "Emerald Leaf", price: 15, rarity: "rare", minHoe: 2, emoji: "üçÄ" },
            { name: "Ruby Berry", price: 17, rarity: "rare", minHoe: 3, emoji: "üçí" },
            { name: "Strawberry", price: 15, rarity: "epic", minHoe: 4, emoji: "üçì" },
            { name: "Blueberry", price: 18, rarity: "epic", minHoe: 5, emoji: "ü´ê" },
            { name: "Silver Corn", price: 19, rarity: "epic", minHoe: 5, emoji: "üåΩ" },
            { name: "Avocado", price: 20, rarity: "epic", minHoe: 6, emoji: "ü•ë" },
            { name: "Mystic Herb", price: 25, rarity: "mythical", minHoe: 4, emoji: "üåø" },
            { name: "Saffron", price: 50, rarity: "legendary", minHoe: 6, emoji: "üå∏" },
            { name: "Truffle", price: 80, rarity: "legendary", minHoe: 6, emoji: "üçÑ" }
        ];

        const FERTILIZERS = [
            { id: "mud", name: "Mud", bonus: 1, cost: 50, emoji: "üí©" },
            { id: "soil", name: "Soil", bonus: 2, cost: 100, emoji: "üü§" },
            { id: "compost", name: "Compost", bonus: 3, cost: 200, emoji: "‚ôªÔ∏è" },
            { id: "manure", name: "Manure", bonus: 5, cost: 300, emoji: "üí™" },
            { id: "organic", name: "Organic", bonus: 8, cost: 500, emoji: "üå±" },
            { id: "bio", name: "Bio", bonus: 10, cost: 800, emoji: "üß¨" },
            { id: "vermicompost", name: "Vermicompost", bonus: 12, cost: 1000, emoji: "ü™±" },
            { id: "liquid", name: "Liquid", bonus: 15, cost: 1200, emoji: "üíß" },
            { id: "chemical", name: "Chemical", bonus: 20, cost: 1500, emoji: "‚öóÔ∏è" },
            { id: "superphosphate", name: "Superphosphate", bonus: 25, cost: 1800, emoji: "üöÄ" }
        ];

        const UPGRADES = [
            { id: "sharperTools", name: "Sharper Tools", desc: "+1 yield per level", maxLevel: 20, baseCost: 250, type: "yield" },
            { id: "expertFarmer", name: "Expert Farmer", desc: "+10% sell price per level", maxLevel: 10, baseCost: 250, type: "economic" },
            { id: "businessman", name: "Businessman", desc: "+5% sell price per level", maxLevel: 20, baseCost: 500, type: "economic" },
            { id: "marketSpecialist", name: "Market Specialist", desc: "+5% sell price per level", maxLevel: 10, baseCost: 750, type: "economic" },
            { id: "irrigationSystem", name: "Irrigation System", desc: "√ó1.2 yield per level", maxLevel: 5, baseCost: 1000, type: "yield" },
            { id: "automatedSprinkler", name: "Automated Sprinkler", desc: "+2 yield per level", maxLevel: 10, baseCost: 2000, type: "yield" },
            { id: "duplicator", name: "Duplicator", desc: "+5% chance to double yield", maxLevel: 3, baseCost: 2500, type: "special" },
            { id: "experienced", name: "Experienced", desc: "+20% XP per level", maxLevel: 5, baseCost: 2500, type: "xp" },
            { id: "fertilizerEfficiency", name: "Fertilizer Efficiency", desc: "+10% fertilizer bonus", maxLevel: 5, baseCost: 1500, type: "fertilizer" },
            { id: "seedMultiplier", name: "Seed Multiplier", desc: "+10% yield per level", maxLevel: 5, baseCost: 2000, type: "yield" },
            { id: "advancedAnalytics", name: "Advanced Analytics", desc: "+3% all bonuses", maxLevel: 5, baseCost: 3000, type: "special" }
        ];

        const ACHIEVEMENTS = [
            { id: "firstSteps", name: "First Steps", desc: "Harvest your first plant", icon: "üå±", check: (g) => g.stats.totalFarms >= 1 },
            { id: "businessman", name: "Businessman", desc: "Earn $10,000 in a single sale", icon: "üí∞", check: (g) => g.stats.bestSingleSale >= 10000 },
            { id: "collector", name: "Collector", desc: "Harvest all 20 plant types", icon: "üéØ", check: (g) => Object.keys(g.stats.plantTypesHarvested).length >= 20 },
            { id: "legendaryHarvest", name: "Legendary Harvest", desc: "Obtain a Truffle or Saffron", icon: "üëë", check: (g) => (g.stats.plantTypesHarvested["Truffle"] || 0) > 0 || (g.stats.plantTypesHarvested["Saffron"] || 0) > 0 },
            { id: "efficiencyExpert", name: "Efficiency Expert", desc: "Max Fertilizer Efficiency", icon: "‚ö°", check: (g) => g.upgrades.fertilizerEfficiency >= 5 },
            { id: "toolMaster", name: "Tool Master", desc: "Unlock all 13 hoes", icon: "‚õèÔ∏è", check: (g) => g.currentHoeIndex >= 12 },
            { id: "greenThumb", name: "Green Thumb", desc: "Harvest 10,000 total plants", icon: "üåø", check: (g) => g.stats.totalPlantsHarvested >= 10000 },
            { id: "millionaire", name: "Millionaire", desc: "Accumulate $100,000 total", icon: "ü§ë", check: (g) => g.stats.totalMoneyEarned >= 100000 },
            { id: "hundredFarms", name: "Century Farmer", desc: "Farm 100 times", icon: "üíØ", check: (g) => g.stats.totalFarms >= 100 },
            { id: "prestigeOnce", name: "Reborn", desc: "Prestige for the first time", icon: "‚≠ê", check: (g) => g.prestigeLevel >= 1 },
            { id: "prestigeFive", name: "Veteran", desc: "Reach prestige level 5", icon: "üåü", check: (g) => g.prestigeLevel >= 5 },
            { id: "fertilizerHoarder", name: "Fertilizer Hoarder", desc: "Own 100 fertilizers total", icon: "üß™", check: (g) => Object.values(g.fertilizers).reduce((a,b) => a+b, 0) >= 100 }
        ];

        const RARITY_CONSUMPTION = { normal: 1, rare: 2, epic: 3, legendary: 4, mythical: 5 };
        const COOLDOWN_TIME = 1500; // 1.5 seconds

        // ===================== GAME STATE =====================
        let game = null;
        let cooldownActive = false;
        let cooldownTimer = null;
        let upgradePage = 0;
        const UPGRADES_PER_PAGE = 5;

        function getDefaultGameState() {
            const fertilizers = {};
            FERTILIZERS.forEach(f => fertilizers[f.id] = 0);
            
            const upgrades = {};
            UPGRADES.forEach(u => upgrades[u.id] = 0);
            
            const inventory = {};
            PLANTS.forEach(p => inventory[p.name] = 0);

            return {
                balance: 80000000000000000,
                xp: 0,
                currentHoeIndex: 0,
                selectedHoeIndex: 0,
                selectedFertilizer: "none",
                fertilizers: fertilizers,
                upgrades: upgrades,
                inventory: inventory,
                prestigeLevel: 0,
                prestigePoints: 0,
                achievements: {},
                stats: {
                    totalFarms: 0,
                    totalMoneyEarned: 0,
                    totalPlantsHarvested: 0,
                    bestSingleHarvest: 0,
                    bestSingleSale: 0,
                    totalFertilizerUsed: 0,
                    plantTypesHarvested: {}
                }
            };
        }

        // ===================== SAVE/LOAD =====================
        function saveGame() {
            try {
                localStorage.setItem('virtualFarmerSave', JSON.stringify(game));
            } catch (error) {
                console.error("Save failed:", error);
                showNotification("Failed to save game!", "error");
            }
        }

        function loadGame() {
            try {
                const savedGame = localStorage.getItem('virtualFarmerSave');
                if (savedGame) {
                    const parsed = JSON.parse(savedGame);
                    if (parsed.balance !== undefined && parsed.xp !== undefined) {
                        game = parsed;
                        // Ensure all properties exist (for older saves)
                        const defaults = getDefaultGameState();
                        game.stats = { ...defaults.stats, ...game.stats };
                        game.achievements = game.achievements || {};
                        game.prestigeLevel = game.prestigeLevel || 0;
                        game.prestigePoints = game.prestigePoints || 0;
                        // Ensure all fertilizers exist
                        FERTILIZERS.forEach(f => {
                            if (game.fertilizers[f.id] === undefined) game.fertilizers[f.id] = 0;
                        });
                        // Ensure all upgrades exist
                        UPGRADES.forEach(u => {
                            if (game.upgrades[u.id] === undefined) game.upgrades[u.id] = 0;
                        });
                        // Ensure all plants in inventory
                        PLANTS.forEach(p => {
                            if (game.inventory[p.name] === undefined) game.inventory[p.name] = 0;
                        });
                    } else {
                        throw new Error("Invalid save structure");
                    }
                } else {
                    game = getDefaultGameState();
                }
            } catch (error) {
                console.error("Load failed:", error);
                game = getDefaultGameState();
            }
        }

        function exportSave() {
            const saveData = btoa(JSON.stringify(game));
            document.getElementById('saveTextarea').value = saveData;
            showNotification("Save exported! Copy the text above.", "achievement");
        }

        function importSave() {
            const textarea = document.getElementById('saveTextarea');
            const saveData = textarea.value.trim();
            if (!saveData) {
                showNotification("Paste save data first!", "error");
                return;
            }
            try {
                const decoded = JSON.parse(atob(saveData));
                if (decoded.balance !== undefined && decoded.xp !== undefined) {
                    game = decoded;
                    saveGame();
                    updateAllUI();
                    showNotification("Save imported successfully!", "achievement");
                } else {
                    throw new Error("Invalid save data");
                }
            } catch (error) {
                showNotification("Invalid save data!", "error");
            }
        }

        function resetGame() {
            if (confirm("Are you sure you want to reset ALL progress? This cannot be undone!")) {
                game = getDefaultGameState();
                saveGame();
                updateAllUI();
                showNotification("Game reset!", "normal");
            }
        }

        // ===================== NOTIFICATIONS =====================
        function showNotification(message, type = "normal") {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 2500);
        }

        // ===================== CALCULATIONS =====================
        function getUpgradeCost(upgradeId, level) {
            const upgrade = UPGRADES.find(u => u.id === upgradeId);
            return Math.floor(upgrade.baseCost * Math.pow(1.15, level));
        }

        function getPrestigeMultiplier() {
            return 1 + (game.prestigeLevel * 0.02) + (game.prestigePoints * 0.01);
        }

        function calculateYield() {
            const hoe = HOES[game.selectedHoeIndex];
            const baseMin = 10 + game.selectedHoeIndex * 5;
            const baseMax = 20 + game.selectedHoeIndex * 5;
            let yield_ = Math.floor(Math.random() * (baseMax - baseMin + 1)) + baseMin;
            
            // Apply hoe multiplier
            yield_ = Math.floor(yield_ * hoe.multiplier);
            
            // Apply fertilizer bonus
            if (game.selectedFertilizer !== "none" && game.fertilizers[game.selectedFertilizer] > 0) {
                const fert = FERTILIZERS.find(f => f.id === game.selectedFertilizer);
                let fertBonus = fert.bonus;
                // Apply fertilizer efficiency upgrade
                fertBonus = Math.floor(fertBonus * (1 + game.upgrades.fertilizerEfficiency * 0.1));
                yield_ += fertBonus;
            }
            
            // Apply sharper tools
            yield_ += game.upgrades.sharperTools;
            
            // Apply automated sprinkler
            yield_ += game.upgrades.automatedSprinkler * 2;
            
            // Apply seed multiplier
            yield_ = Math.floor(yield_ * (1 + game.upgrades.seedMultiplier * 0.1));
            
            // Apply irrigation system (multiplicative)
            yield_ = Math.floor(yield_ * Math.pow(1.2, game.upgrades.irrigationSystem));
            
            // Apply advanced analytics
            yield_ = Math.floor(yield_ * (1 + game.upgrades.advancedAnalytics * 0.03));
            
            // Apply prestige bonus
            yield_ = Math.floor(yield_ * getPrestigeMultiplier());
            
            // Apply duplicator
            const duplicatorChance = game.upgrades.duplicator * 0.05;
            if (Math.random() < duplicatorChance) {
                yield_ *= 2;
            }
            
            return Math.max(1, yield_);
        }

        function calculateXP() {
            const baseMin = 10 + game.selectedHoeIndex * 5;
            const baseMax = 15 + game.selectedHoeIndex * 5;
            let xp = Math.floor(Math.random() * (baseMax - baseMin + 1)) + baseMin;
            
            // Apply experienced upgrade
            xp = Math.floor(xp * (1 + game.upgrades.experienced * 0.2));
            
            // Apply prestige bonus
            xp = Math.floor(xp * getPrestigeMultiplier());
            
            return Math.min(50, xp);
        }

        function getEligiblePlants() {
            return PLANTS.filter(p => p.minHoe <= game.selectedHoeIndex);
        }

        function selectRandomPlant() {
            const eligible = getEligiblePlants();
            return eligible[Math.floor(Math.random() * eligible.length)];
        }

        function calculateSellPrice() {
            let total = 0;
            PLANTS.forEach(plant => {
                const count = game.inventory[plant.name] || 0;
                if (count > 0) {
                    let price = plant.price * count;
                    
                    // Apply expert farmer
                    price *= (1 + game.upgrades.expertFarmer * 0.1);
                    
                    // Apply businessman
                    price *= (1 + game.upgrades.businessman * 0.05);
                    
                    // Apply market specialist
                    price *= (1 + game.upgrades.marketSpecialist * 0.05);
                    
                    // Apply advanced analytics
                    price *= (1 + game.upgrades.advancedAnalytics * 0.03);
                    
                    // Apply prestige bonus
                    price *= getPrestigeMultiplier();
                    
                    total += price;
                }
            });
            return Math.floor(total);
        }

        function getTotalPlants() {
            return Object.values(game.inventory).reduce((a, b) => a + b, 0);
        }

        function getTotalFertilizers() {
            return Object.values(game.fertilizers).reduce((a, b) => a + b, 0);
        }

        // ===================== GAME ACTIONS =====================
        function farm() {
            if (cooldownActive) return;
            
            // Select plant and calculate yield
            const plant = selectRandomPlant();
            const yield_ = calculateYield();
            const xp = calculateXP();
            
            // Consume fertilizer if selected
            if (game.selectedFertilizer !== "none") {
                const consumption = RARITY_CONSUMPTION[plant.rarity] || 1;
                if (game.fertilizers[game.selectedFertilizer] >= consumption) {
                    game.fertilizers[game.selectedFertilizer] -= consumption;
                    game.stats.totalFertilizerUsed += consumption;
                } else if (game.fertilizers[game.selectedFertilizer] > 0) {
                    // Use what's left
                    game.stats.totalFertilizerUsed += game.fertilizers[game.selectedFertilizer];
                    game.fertilizers[game.selectedFertilizer] = 0;
                }
                // Auto-deselect if empty
                if (game.fertilizers[game.selectedFertilizer] <= 0) {
                    game.selectedFertilizer = "none";
                }
            }
            
            // Add to inventory
            game.inventory[plant.name] = (game.inventory[plant.name] || 0) + yield_;
            game.xp += xp;
            
            // Update stats
            game.stats.totalFarms++;
            game.stats.totalPlantsHarvested += yield_;
            game.stats.bestSingleHarvest = Math.max(game.stats.bestSingleHarvest, yield_);
            game.stats.plantTypesHarvested[plant.name] = (game.stats.plantTypesHarvested[plant.name] || 0) + yield_;
            
            // Show notification
            showNotification(`${plant.emoji} Harvested ${yield_} ${plant.name}!`, plant.rarity);
            
            // Check achievements
            checkAchievements();
            
            // Save and update UI
            saveGame();
            updateAllUI();
            
            // Start cooldown
            startCooldown();
        }

        function startCooldown() {
            cooldownActive = true;
            const farmBtn = document.getElementById('farmBtn');
            const cooldownBar = document.getElementById('cooldownBar');
            farmBtn.disabled = true;
            
            let elapsed = 0;
            const interval = 50;
            cooldownBar.style.width = '0%';
            
            cooldownTimer = setInterval(() => {
                elapsed += interval;
                const progress = (elapsed / COOLDOWN_TIME) * 100;
                cooldownBar.style.width = `${progress}%`;
                
                if (elapsed >= COOLDOWN_TIME) {
                    clearInterval(cooldownTimer);
                    cooldownActive = false;
                    farmBtn.disabled = false;
                    cooldownBar.style.width = '0%';
                }
            }, interval);
        }

        function sellAll() {
            const total = calculateSellPrice();
            if (total === 0) {
                showNotification("No plants to sell!", "error");
                return;
            }
            
            game.balance += total;
            game.stats.totalMoneyEarned += total;
            game.stats.bestSingleSale = Math.max(game.stats.bestSingleSale, total);
            
            // Clear inventory
            PLANTS.forEach(p => game.inventory[p.name] = 0);
            
            showNotification(`üí∞ Sold for $${total.toLocaleString()}!`, "achievement");
            
            checkAchievements();
            saveGame();
            updateAllUI();
        }

        function buyHoe(index) {
            const hoe = HOES[index];
            if (index <= game.currentHoeIndex) {
                showNotification("Already owned!", "error");
                return;
            }
            if (index !== game.currentHoeIndex + 1) {
                showNotification("Buy previous hoes first!", "error");
                return;
            }
            if (game.balance < hoe.cost) {
                showNotification("Not enough money!", "error");
                return;
            }
            
            game.balance -= hoe.cost;
            game.currentHoeIndex = index;
            game.selectedHoeIndex = index;
            
            showNotification(`${hoe.emoji} Unlocked ${hoe.name}!`, "achievement");
            
            checkAchievements();
            saveGame();
            updateAllUI();
        }

        function equipHoe(index) {
            if (index > game.currentHoeIndex) {
                showNotification("Hoe not unlocked!", "error");
                return;
            }
            game.selectedHoeIndex = index;
            saveGame();
            updateAllUI();
        }

        function selectHoe(index) {
            index = parseInt(index);
            if (index <= game.currentHoeIndex) {
                game.selectedHoeIndex = index;
                saveGame();
                updateAllUI();
            }
        }

        function selectFertilizer(id) {
            if (id === "none" || game.fertilizers[id] > 0) {
                game.selectedFertilizer = id;
                saveGame();
                updateAllUI();
            }
        }

        function buyFertilizer(id, amount = 1) {
            const fert = FERTILIZERS.find(f => f.id === id);
            const totalCost = fert.cost * amount;
            
            if (game.balance < totalCost) {
                showNotification("Not enough money!", "error");
                return;
            }
            
            game.balance -= totalCost;
            game.fertilizers[id] += amount;
            
            showNotification(`${fert.emoji} Bought ${amount} ${fert.name}!`, "normal");
            
            checkAchievements();
            saveGame();
            updateAllUI();
        }

        function buyUpgrade(id) {
            const upgrade = UPGRADES.find(u => u.id === id);
            const currentLevel = game.upgrades[id];
            
            if (currentLevel >= upgrade.maxLevel) {
                showNotification("Already maxed!", "error");
                return;
            }
            
            const cost = getUpgradeCost(id, currentLevel);
            if (game.balance < cost) {
                showNotification("Not enough money!", "error");
                return;
            }
            
            game.balance -= cost;
            game.upgrades[id]++;
            
            showNotification(`‚¨ÜÔ∏è ${upgrade.name} upgraded to level ${game.upgrades[id]}!`, "normal");
            
            checkAchievements();
            saveGame();
            updateAllUI();
        }

        function buyMaxUpgrade(id) {
            const upgrade = UPGRADES.find(u => u.id === id);
            let bought = 0;
            
            while (game.upgrades[id] < upgrade.maxLevel) {
                const cost = getUpgradeCost(id, game.upgrades[id]);
                if (game.balance < cost) break;
                game.balance -= cost;
                game.upgrades[id]++;
                bought++;
            }
            
            if (bought > 0) {
                showNotification(`‚¨ÜÔ∏è ${upgrade.name} +${bought} levels!`, "normal");
                checkAchievements();
                saveGame();
                updateAllUI();
            } else {
                showNotification("Can't afford any levels!", "error");
            }
        }

        // ===================== PRESTIGE =====================
        function canPrestige() {
            return game.balance >= 50000 || (game.currentHoeIndex >= 12 && Object.values(game.upgrades).every((v, i) => v >= UPGRADES[i]?.maxLevel));
        }

        function getPrestigePointsEarned() {
            // 1 point per $25,000 balance
            return Math.floor(game.balance / 25000);
        }

        function prestige() {
            if (!canPrestige()) {
                showNotification("Requirements not met!", "error");
                return;
            }
            
            if (!confirm(`Are you sure you want to prestige?\nYou will gain ${getPrestigePointsEarned()} Prestige Points.`)) {
                return;
            }
            
            const pointsEarned = getPrestigePointsEarned();
            const oldLevel = game.prestigeLevel;
            
            // Reset most progress
            const fertilizers = {};
            FERTILIZERS.forEach(f => fertilizers[f.id] = 0);
            const upgrades = {};
            UPGRADES.forEach(u => upgrades[u.id] = 0);
            const inventory = {};
            PLANTS.forEach(p => inventory[p.name] = 0);
            
            // Keep prestige data and stats
            game.balance = 0;
            game.xp = 0;
            game.currentHoeIndex = 0;
            game.selectedHoeIndex = 0;
            game.selectedFertilizer = "none";
            game.fertilizers = fertilizers;
            game.upgrades = upgrades;
            game.inventory = inventory;
            game.prestigeLevel++;
            game.prestigePoints += pointsEarned;
            
            showNotification(`‚≠ê Prestige Level ${game.prestigeLevel}! +${pointsEarned} points!`, "legendary");
            
            checkAchievements();
            saveGame();
            updateAllUI();
        }

        // ===================== ACHIEVEMENTS =====================
        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if (!game.achievements[ach.id] && ach.check(game)) {
                    game.achievements[ach.id] = true;
                    showNotification(`üèÜ Achievement: ${ach.name}!`, "achievement");
                }
            });
        }

        // ===================== UI UPDATES =====================
        function updateAllUI() {
            updateStatsPanel();
            updateHoeSelect();
            updateFertilizerSelect();
            updateFertilizerDisplay();
            renderInventory();
            renderHoeShop();
            renderFertilizerShop();
            renderUpgrades();
            renderAchievements();
            renderDetailedStats();
            renderPrestige();
        }

        function updateStatsPanel() {
            const panel = document.getElementById('statsPanel');
            const hoe = HOES[game.selectedHoeIndex];
            panel.innerHTML = `
                <div class="stat-item">
                    <div class="label">Balance</div>
                    <div class="value">$${game.balance.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">XP</div>
                    <div class="value">${game.xp.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Plants</div>
                    <div class="value">${getTotalPlants().toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Current Hoe</div>
                    <div class="value">${hoe.emoji} ${hoe.name}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Prestige Level</div>
                    <div class="value">‚≠ê ${game.prestigeLevel}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Prestige Bonus</div>
                    <div class="value">+${((getPrestigeMultiplier() - 1) * 100).toFixed(1)}%</div>
                </div>
            `;
        }

        function updateHoeSelect() {
            const select = document.getElementById('hoeSelect');
            select.innerHTML = '';
            for (let i = 0; i <= game.currentHoeIndex; i++) {
                const hoe = HOES[i];
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${hoe.emoji} ${hoe.name} (${hoe.multiplier}x)`;
                option.selected = i === game.selectedHoeIndex;
                select.appendChild(option);
            }
        }

        function updateFertilizerSelect() {
            const select = document.getElementById('fertilizerSelect');
            select.innerHTML = '<option value="none">No Fertilizer</option>';
            FERTILIZERS.forEach(fert => {
                const count = game.fertilizers[fert.id];
                const option = document.createElement('option');
                option.value = fert.id;
                option.textContent = `${fert.emoji} ${fert.name} (+${fert.bonus}) - ${count} owned`;
                option.disabled = count <= 0;
                option.selected = fert.id === game.selectedFertilizer;
                select.appendChild(option);
            });
        }

        function updateFertilizerDisplay() {
            const display = document.getElementById('fertilizerDisplay');
            display.innerHTML = FERTILIZERS.map(f => 
                `<span class="fertilizer-badge">${f.emoji} ${f.name}: ${game.fertilizers[f.id]}</span>`
            ).join('');
        }

        function renderInventory() {
            const grid = document.getElementById('inventoryGrid');
            const filter = document.getElementById('inventoryFilter').value;
            const sort = document.getElementById('inventorySort').value;
            
            let plants = PLANTS.filter(p => {
                if (filter === 'all') return true;
                return p.rarity === filter;
            });
            
            plants.sort((a, b) => {
                switch(sort) {
                    case 'quantity': return (game.inventory[b.name] || 0) - (game.inventory[a.name] || 0);
                    case 'value': return b.price - a.price;
                    case 'rarity': {
                        const order = ['legendary', 'mythical', 'epic', 'rare', 'normal'];
                        return order.indexOf(a.rarity) - order.indexOf(b.rarity);
                    }
                    default: return a.name.localeCompare(b.name);
                }
            });
            
            grid.innerHTML = plants.map(p => {
                const count = game.inventory[p.name] || 0;
                return `
                    <div class="inventory-item ${p.rarity}">
                        <div class="name">${p.emoji} ${p.name}</div>
                        <div class="count">${count.toLocaleString()}</div>
                        <div style="font-size: 11px; opacity: 0.7;">$${p.price} each</div>
                    </div>
                `;
            }).join('');
        }

        function renderHoeShop() {
            const grid = document.getElementById('hoeShopGrid');
            grid.innerHTML = HOES.map((hoe, i) => {
                const owned = i <= game.currentHoeIndex;
                const equipped = i === game.selectedHoeIndex;
                const canBuy = i === game.currentHoeIndex + 1 && game.balance >= hoe.cost;
                
                return `
                    <div class="item-card">
                        <h3>${hoe.emoji} ${hoe.name}</h3>
                        <div class="details">
                            <div>Multiplier: <strong>${hoe.multiplier}x</strong></div>
                            ${!owned ? `<div class="price">Cost: $${hoe.cost.toLocaleString()}</div>` : ''}
                            ${owned ? '<div class="owned">‚úì Owned</div>' : ''}
                            ${equipped ? '<div class="equipped">‚òÖ Equipped</div>' : ''}
                        </div>
                        ${!owned ? `<button class="btn" onclick="buyHoe(${i})" ${!canBuy ? 'disabled' : ''}>Buy</button>` : ''}
                        ${owned && !equipped ? `<button class="btn btn-secondary" onclick="equipHoe(${i})">Equip</button>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderFertilizerShop() {
            const grid = document.getElementById('fertilizerShopGrid');
            grid.innerHTML = FERTILIZERS.map(fert => {
                const owned = game.fertilizers[fert.id];
                const canBuy = game.balance >= fert.cost;
                const canBuy10 = game.balance >= fert.cost * 10;
                
                return `
                    <div class="item-card">
                        <h3>${fert.emoji} ${fert.name}</h3>
                        <div class="details">
                            <div>Bonus: <strong>+${fert.bonus} yield</strong></div>
                            <div class="price">Cost: $${fert.cost.toLocaleString()}</div>
                            <div class="owned">Owned: ${owned}</div>
                        </div>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button class="btn" onclick="buyFertilizer('${fert.id}', 1)" ${!canBuy ? 'disabled' : ''}>Buy 1</button>
                            <button class="btn btn-secondary" onclick="buyFertilizer('${fert.id}', 10)" ${!canBuy10 ? 'disabled' : ''}>Buy 10</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderUpgrades() {
            const grid = document.getElementById('upgradesGrid');
            const start = upgradePage * UPGRADES_PER_PAGE;
            const end = start + UPGRADES_PER_PAGE;
            const pageUpgrades = UPGRADES.slice(start, end);
            
            grid.innerHTML = pageUpgrades.map(upgrade => {
                const level = game.upgrades[upgrade.id];
                const maxed = level >= upgrade.maxLevel;
                const cost = maxed ? 'MAX' : `$${getUpgradeCost(upgrade.id, level).toLocaleString()}`;
                const canBuy = !maxed && game.balance >= getUpgradeCost(upgrade.id, level);
                
                return `
                    <div class="item-card">
                        <h3>${upgrade.name}</h3>
                        <div class="details">
                            <div>${upgrade.desc}</div>
                            <div class="level">Level: ${level}/${upgrade.maxLevel}</div>
                            <div class="price">Next: ${cost}</div>
                        </div>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button class="btn" onclick="buyUpgrade('${upgrade.id}')" ${!canBuy ? 'disabled' : ''}>Buy</button>
                            <button class="btn btn-secondary" onclick="buyMaxUpgrade('${upgrade.id}')" ${maxed ? 'disabled' : ''}>Buy Max</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            const totalPages = Math.ceil(UPGRADES.length / UPGRADES_PER_PAGE);
            document.getElementById('upgradePageInfo').textContent = `Page ${upgradePage + 1} of ${totalPages}`;
        }

        function changeUpgradePage(delta) {
            const totalPages = Math.ceil(UPGRADES.length / UPGRADES_PER_PAGE);
            upgradePage = Math.max(0, Math.min(totalPages - 1, upgradePage + delta));
            renderUpgrades();
        }

        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            grid.innerHTML = ACHIEVEMENTS.map(ach => {
                const unlocked = game.achievements[ach.id];
                return `
                    <div class="achievement-card ${unlocked ? 'unlocked' : ''}">
                        <div class="achievement-icon">${unlocked ? ach.icon : 'üîí'}</div>
                        <div class="achievement-info">
                            <h4>${ach.name}</h4>
                            <p>${ach.desc}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderDetailedStats() {
            const grid = document.getElementById('detailedStats');
            const avgYield = game.stats.totalFarms > 0 
                ? (game.stats.totalPlantsHarvested / game.stats.totalFarms).toFixed(1) 
                : 0;
            const plantTypes = Object.keys(game.stats.plantTypesHarvested).length;
            
            grid.innerHTML = `
                <div class="stat-item">
                    <div class="label">Total Farms</div>
                    <div class="value">${game.stats.totalFarms.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Average Yield</div>
                    <div class="value">${avgYield}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Total Money Earned</div>
                    <div class="value">$${game.stats.totalMoneyEarned.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Best Single Harvest</div>
                    <div class="value">${game.stats.bestSingleHarvest.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Best Single Sale</div>
                    <div class="value">$${game.stats.bestSingleSale.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Total Plants Harvested</div>
                    <div class="value">${game.stats.totalPlantsHarvested.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Plant Types Discovered</div>
                    <div class="value">${plantTypes}/20</div>
                </div>
                <div class="stat-item">
                    <div class="label">Fertilizer Used</div>
                    <div class="value">${game.stats.totalFertilizerUsed.toLocaleString()}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Achievements Unlocked</div>
                    <div class="value">${Object.keys(game.achievements).length}/${ACHIEVEMENTS.length}</div>
                </div>
                <div class="stat-item">
                    <div class="label">Prestige Points</div>
                    <div class="value">${game.prestigePoints}</div>
                </div>
            `;
        }

        function renderPrestige() {
            const bonus = document.getElementById('prestigeBonus');
            const requirement = document.getElementById('prestigeRequirement');
            const btn = document.getElementById('prestigeBtn');
            
            const currentBonus = ((getPrestigeMultiplier() - 1) * 100).toFixed(1);
            const pointsToEarn = getPrestigePointsEarned();
            
            bonus.innerHTML = `
                Current Bonus: +${currentBonus}% to all yields and XP<br>
                <small>Prestige Points: ${game.prestigePoints}</small>
            `;
            
            const canP = canPrestige();
            requirement.innerHTML = canP 
                ? `‚úì You can prestige now! You'll earn <strong>${pointsToEarn}</strong> Prestige Points.`
                : `Need $50,000 balance or all max upgrades with Titanium Hoe.<br>Current: $${game.balance.toLocaleString()}`;
            
            btn.disabled = !canP;
        }

        // ===================== PAGE NAVIGATION =====================
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            
            updateAllUI();
        }

        // ===================== KEYBOARD SHORTCUTS =====================
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    farm();
                    break;
                case 's':
                    sellAll();
                    break;
                case 'f':
                    cycleFertilizer();
                    break;
                case '1': case '2': case '3': case '4': case '5':
                case '6': case '7': case '8': case '9':
                    const hoeIndex = parseInt(e.key) - 1;
                    if (hoeIndex <= game.currentHoeIndex) {
                        selectHoe(hoeIndex);
                    }
                    break;
            }
        });

        function cycleFertilizer() {
            const fertIds = ['none', ...FERTILIZERS.map(f => f.id)];
            let currentIndex = fertIds.indexOf(game.selectedFertilizer);
            
            // Find next available fertilizer
            for (let i = 1; i <= fertIds.length; i++) {
                const nextIndex = (currentIndex + i) % fertIds.length;
                const nextId = fertIds[nextIndex];
                if (nextId === 'none' || game.fertilizers[nextId] > 0) {
                    game.selectedFertilizer = nextId;
                    saveGame();
                    updateAllUI();
                    break;
                }
            }
        }

        // ===================== INITIALIZATION =====================
        function init() {
            loadGame();
            updateAllUI();
            
            // Auto-save every 30 seconds
            setInterval(saveGame, 30000);
        }

        init();
    </script>
</body>
</html>